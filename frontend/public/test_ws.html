<!DOCTYPE html>
<html>
<head>
    <title>Centrifugo Direct Port Test</title>
    <script src="/vendor/centrifuge.min.js"></script>
    <style>
        body { font-family: monospace; background: #0f172a; color: #38bdf8; padding: 20px; }
        .log { margin-bottom: 5px; border-bottom: 1px solid #1e293b; padding: 5px; }
        .error { color: #f87171; }
        .success { color: #4ade80; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üõ∞ Centrifugo Direct Port Test (8008)</h1>
    <div id="status">Estado: <span style="color: #fbbf24;">Conectando al puerto 8008...</span></div>
    <hr>
    <div id="logs"></div>

    <script>
        const logBox = document.getElementById('logs');
        const statusBox = document.getElementById('status');

        function addLog(msg, isError = false) {
            const div = document.createElement('div');
            div.className = 'log ' + (isError ? 'error' : '');
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logBox.prepend(div);
        }

        addLog("Iniciando conexion DIRECTA...");
        
        // CONEXION DIRECTA AL PUERTO 8008
        const wsUrl = `ws://${window.location.hostname}:8008/connection/websocket`;
        addLog("URL WebSocket: " + wsUrl);

        const centrifuge = new Centrifuge(wsUrl);

        centrifuge.on('connected', function(ctx){
            addLog("CONECTADO DIRECTAMENTE ‚úÖ");
            statusBox.innerHTML = 'Estado: <span class="success">CONECTADO AL PUERTO 8008 ‚úÖ</span>';
        });

        centrifuge.on('disconnected', function(ctx){
            addLog("DESCONECTADO ‚ùå: " + ctx.reason, true);
            statusBox.innerHTML = 'Estado: <span class="error">FALL√ì CONEXI√ìN DIRECTA ‚ùå</span>';
        });

        const sub = centrifuge.newSubscription('pedidos');

        sub.on('publication', function(ctx) {
            addLog("MENSAGE RECIBIDO üì©: " + JSON.stringify(ctx.data));
        });

        sub.on('subscribed', function(ctx) {
            addLog("SUSCRITO AL CANAL 'pedidos' ‚úÖ");
        });

        sub.on('error', function(err) {
            addLog("ERROR EN SUSCRIPCION ‚ùå: " + (err.message || "Permiso denegado"), true);
        });

        sub.subscribe();
        centrifuge.connect();
    </script>
</body>
</html>
