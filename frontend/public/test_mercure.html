<!DOCTYPE html>
<html>
<head>
    <title>Mercure Test</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #00d4ff; padding: 20px; }
        .log { margin-bottom: 5px; border-bottom: 1px solid #333; padding: 5px; }
        .success { color: #00ff00; font-weight: bold; }
    </style>
</head>
<body>
    <h1>üõ∞ Mercure Raw Test</h1>
    <div id="status">Estado: <span style="color: yellow;">Conectando a SSE...</span></div>
    <hr>
    <div id="logs"></div>

    <script>
        const logBox = document.getElementById('logs');
        const statusBox = document.getElementById('status');

        function addLog(msg) {
            const div = document.createElement('div');
            div.className = 'log';
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logBox.prepend(div);
        }

        const url = new URL('http://localhost/.well-known/mercure');
        url.searchParams.append('topic', 'donwok/pedidos');

        addLog("Intentando conectar a: " + url.href);

        const eventSource = new EventSource(url);

        eventSource.onopen = () => {
            addLog("CONECTADO ‚úÖ (Esperando mensajes...)");
            statusBox.innerHTML = 'Estado: <span class="success">CONECTADO ‚úÖ</span>';
        };

        eventSource.onmessage = (event) => {
            addLog("EVENTO RECIBIDO üì©: " + event.data);
        };

        eventSource.onerror = (err) => {
            console.error("Error SSE:", err);
            addLog("ERROR O RECONEXION ‚ö†Ô∏è");
        };
    </script>
</body>
</html>
