{% extends 'base.html.twig' %}

{% block title %}Dashboard - DonWok{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-dark m-0">Panel de Control</h2>
            <p class="text-muted">Resumen financiero consolidado al día de hoy</p>
        </div>
        <a href="/informes/balance" class="btn btn-primary fw-bold px-4 py-2 shadow-sm">
            <i class="bi bi-file-earmark-bar-graph me-2"></i> BALANCE GENERAL
        </a>
    </div>

    <div class="row g-4 mb-5" id="dashboard-stats">
        <div class="col-md-3">
            <div class="glass-card p-4 border-start border-5 border-success shadow-sm h-100">
                <small class="text-muted fw-bold d-block mb-1">EFECTIVO EN CAJA</small>
                <h3 class="fw-extrabold m-0 text-success" id="dash-efectivo">$0.00</h3>
                <div class="small text-muted border-top pt-2 mt-3">Caja Principal</div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="glass-card p-4 border-start border-5 border-info shadow-sm h-100">
                <small class="text-muted fw-bold d-block mb-1">BANCO (NEQUI)</small>
                <h3 class="fw-extrabold m-0 text-info" id="dash-banco">$0.00</h3>
                <div class="small text-muted border-top pt-2 mt-3">Cuenta Nequi</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="glass-card p-4 border-start border-5 border-primary shadow-sm h-100">
                <small class="text-muted fw-bold d-block mb-1">CARTERA (POR COBRAR)</small>
                <h3 class="fw-extrabold m-0 text-primary" id="dash-cartera">$0.00</h3>
                <div class="small text-muted border-top pt-2 mt-3">Préstamos otorgados</div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="glass-card p-4 border-start border-5 border-danger shadow-sm h-100">
                <small class="text-muted fw-bold d-block mb-1">DEUDAS (POR PAGAR)</small>
                <h3 class="fw-extrabold m-0 text-danger" id="dash-deudas">$0.00</h3>
                <div class="small text-muted border-top pt-2 mt-3">Obligaciones empresa</div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        {# Accesos Rápidos #}
        <div class="col-md-3">
            <div class="glass-card p-4 text-center">
                <i class="bi bi-cart3 h1 text-secondary mb-3"></i>
                <h6 class="fw-bold">Punto de Venta</h6>
                <a href="/ventas" class="btn btn-outline-secondary btn-sm w-100 mt-2">Ir al POS</a>
            </div>
        </div>
        <div class="col-md-3">
            <div class="glass-card p-4 text-center">
                <i class="bi bi-safe h1 text-secondary mb-3"></i>
                <h6 class="fw-bold">Caja Diaria</h6>
                <a href="/caja" class="btn btn-outline-secondary btn-sm w-100 mt-2">Ver Cierre</a>
            </div>
        </div>
        <div class="col-md-3">
            <div class="glass-card p-4 text-center">
                <i class="bi bi-arrow-down-circle h1 text-secondary mb-3"></i>
                <h6 class="fw-bold">Egresos</h6>
                <a href="/caja/egresos" class="btn btn-outline-secondary btn-sm w-100 mt-2">Registrar</a>
            </div>
        </div>
        <div class="col-md-3">
            <div class="glass-card p-4 text-center">
                <i class="bi bi-box-seam h1 text-secondary mb-3"></i>
                <h6 class="fw-bold">Productos</h6>
                <a href="/productos" class="btn btn-outline-secondary btn-sm w-100 mt-2">Catálogo</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script type="module">
    import CoreAPI from '/js/core.js';
    const api = new CoreAPI();

    async function init() {
        try {
            const data = await api.get('/informes/balance-completo');
            const fmt = (v) => new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP' }).format(v);
            
            const caja = data.liquidez.cuentas.find(c => c.nombre.includes('Caja'))?.saldo || 0;
            const nequi = data.liquidez.cuentas.find(c => c.nombre.includes('Nequi'))?.saldo || 0;
            
            document.getElementById('dash-efectivo').innerText = fmt(caja);
            document.getElementById('dash-banco').innerText = fmt(nequi);
            document.getElementById('dash-cartera').innerText = fmt(data.cartera.total);
            document.getElementById('dash-deudas').innerText = fmt(data.pasivos.total);
        } catch (err) { console.error(err); }
    }

    init();
</script>
{% endblock %}
