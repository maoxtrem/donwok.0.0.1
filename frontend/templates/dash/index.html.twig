{% extends 'base.html.twig' %}

{% block title %}Dashboard - DonWok{% endblock %}

{% block body %}
<div class="container-fluid">
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-5">
        <div>
            <h2 class="fw-bold text-dark m-0" style="letter-spacing: -0.5px;">Panel de Control</h2>
            <p class="text-muted mb-0">Resumen financiero consolidado al día de hoy</p>
        </div>
        <a href="/informes/balance" class="dw-btn-primary text-white text-decoration-none shadow-sm">
            <i class="bi bi-file-earmark-bar-graph me-2"></i> VER BALANCE GENERAL
        </a>
    </div>

    <div class="row g-4 mb-5" id="dashboard-stats">
        <div class="col-sm-6 col-xl-3">
            <div class="dw-card p-4 h-100 position-relative overflow-hidden">
                <div class="position-absolute top-0 end-0 p-3 opacity-10">
                    <i class="bi bi-cash-stack h1 mb-0"></i>
                </div>
                <small class="text-muted fw-bold d-block mb-2">EFECTIVO EN CAJA</small>
                <h2 class="fw-bold m-0 text-success" id="dash-efectivo" style="font-size: 1.8rem;">$0.00</h2>
                <div class="small text-muted mt-3 d-flex align-items-center gap-2">
                    <span class="p-1 bg-success rounded-circle"></span> Caja Principal
                </div>
            </div>
        </div>
        
        <div class="col-sm-6 col-xl-3">
            <div class="dw-card p-4 h-100 position-relative overflow-hidden">
                <div class="position-absolute top-0 end-0 p-3 opacity-10">
                    <i class="bi bi-bank h1 mb-0"></i>
                </div>
                <small class="text-muted fw-bold d-block mb-2">BANCO (NEQUI)</small>
                <h2 class="fw-bold m-0 text-info" id="dash-banco" style="font-size: 1.8rem;">$0.00</h2>
                <div class="small text-muted mt-3 d-flex align-items-center gap-2">
                    <span class="p-1 bg-info rounded-circle"></span> Cuenta Nequi
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
            <div class="dw-card p-4 h-100 position-relative overflow-hidden">
                <div class="position-absolute top-0 end-0 p-3 opacity-10">
                    <i class="bi bi-person-check h1 mb-0"></i>
                </div>
                <small class="text-muted fw-bold d-block mb-2">CARTERA (POR COBRAR)</small>
                <h2 class="fw-bold m-0 text-primary" id="dash-cartera" style="font-size: 1.8rem;">$0.00</h2>
                <div class="small text-muted mt-3 d-flex align-items-center gap-2">
                    <span class="p-1 bg-primary rounded-circle"></span> Préstamos otorgados
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
            <div class="dw-card p-4 h-100 position-relative overflow-hidden">
                <div class="position-absolute top-0 end-0 p-3 opacity-10">
                    <i class="bi bi-credit-card h1 mb-0"></i>
                </div>
                <small class="text-muted fw-bold d-block mb-2">DEUDAS (POR PAGAR)</small>
                <h2 class="fw-bold m-0 text-danger" id="dash-deudas" style="font-size: 1.8rem;">$0.00</h2>
                <div class="small text-muted mt-3 d-flex align-items-center gap-2">
                    <span class="p-1 bg-danger rounded-circle"></span> Obligaciones empresa
                </div>
            </div>
        </div>
    </div>

    <h5 class="fw-bold mb-4 text-dark">Accesos Rápidos</h5>
    <div class="row g-4">
        <div class="col-6 col-md-3">
            <a href="/ventas" class="dw-card p-4 text-center text-decoration-none d-block">
                <div class="bg-light p-3 rounded-circle d-inline-block mb-3">
                    <i class="bi bi-cart3 h3 text-primary mb-0"></i>
                </div>
                <h6 class="fw-bold text-dark mb-0">Punto de Venta</h6>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="/caja" class="dw-card p-4 text-center text-decoration-none d-block">
                <div class="bg-light p-3 rounded-circle d-inline-block mb-3">
                    <i class="bi bi-safe h3 text-primary mb-0"></i>
                </div>
                <h6 class="fw-bold text-dark mb-0">Arqueo Diario</h6>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="/caja/egresos" class="dw-card p-4 text-center text-decoration-none d-block">
                <div class="bg-light p-3 rounded-circle d-inline-block mb-3">
                    <i class="bi bi-arrow-down-circle h3 text-danger mb-0"></i>
                </div>
                <h6 class="fw-bold text-dark mb-0">Egresos Inm.</h6>
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="/productos" class="dw-card p-4 text-center text-decoration-none d-block">
                <div class="bg-light p-3 rounded-circle d-inline-block mb-3">
                    <i class="bi bi-box-seam h3 text-dark mb-0"></i>
                </div>
                <h6 class="fw-bold text-dark mb-0">Inventario</h6>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script type="module">
    import CoreAPI from '/js/core.js';
    const api = new CoreAPI();

    async function init() {
        try {
            const data = await api.get('/informes/balance-completo');
            const fmt = (v) => new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP' }).format(v);
            
            const caja = data.liquidez.cuentas.find(c => c.nombre.includes('Caja'))?.saldo || 0;
            const nequi = data.liquidez.cuentas.find(c => c.nombre.includes('Nequi'))?.saldo || 0;
            
            document.getElementById('dash-efectivo').innerText = fmt(caja);
            document.getElementById('dash-banco').innerText = fmt(nequi);
            document.getElementById('dash-cartera').innerText = fmt(data.cartera.total);
            document.getElementById('dash-deudas').innerText = fmt(data.pasivos.total);
        } catch (err) { console.error(err); }
    }

    init();
</script>
{% endblock %}
